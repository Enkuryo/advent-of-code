<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HelperTool</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    <style>
      body {
        user-select: none;
      }

      .wrapper {
        display: grid;
        grid-template-columns: repeat(3, 50px);
      }

      .wrapper {
        cursor: default;
      }

      .wrapper > div {
        border: 1px solid gray;
        box-sizing: border-box;
        width: 50px;
        height: 50px;
        text-align: center;
        line-height: 3rem;
      }

      .wrapper > .active {
        background-color: darkcyan;
        color: white;
        font-weight: bold;
      }

      #my-input > div:hover {
        background-color: darkcyan;
        color: white;
        font-weight: bold;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="container row">
      <div class="col-3">
        <h1>Main Robot</h1>
        <p>&nbsp;</p>
        <div id="robot-1" class="wrapper">
          <div data-value="7">7</div>
          <div data-value="8">8</div>
          <div data-value="9">9</div>
          <div data-value="4">4</div>
          <div data-value="5">5</div>
          <div data-value="6">6</div>
          <div data-value="1">1</div>
          <div data-value="2">2</div>
          <div data-value="3">3</div>
          <div>
            <?xml version="1.0" encoding="iso-8859-1"?>
            <!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
            <svg
              fill="#000000"
              height="100%"
              width="100%"
              version="1.1"
              id="Capa_1"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              viewBox="0 0 490 490"
              xml:space="preserve"
            >
              <polygon
                points="456.851,0 245,212.564 33.149,0 0.708,32.337 212.669,245.004 0.708,457.678 33.149,490 245,277.443 456.851,490 
              489.292,457.678 277.331,245.004 489.292,32.337 "
              />
            </svg>
          </div>
          <div data-value="0">0</div>
          <div data-value="A" class="active">A</div>
        </div>
      </div>
      <div class="col-3">
        <h2>Robot 2</h2>
        <p>Controls Main</p>
        <div id="robot-2" class="wrapper">
          <div>
            <?xml version="1.0" encoding="iso-8859-1"?>
            <!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
            <svg
              fill="#000000"
              height="100%"
              width="100%"
              version="1.1"
              id="Capa_1"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              viewBox="0 0 490 490"
              xml:space="preserve"
            >
              <polygon
                points="456.851,0 245,212.564 33.149,0 0.708,32.337 212.669,245.004 0.708,457.678 33.149,490 245,277.443 456.851,490 
              489.292,457.678 277.331,245.004 489.292,32.337 "
              />
            </svg>
          </div>
          <div data-action="up">ðŸ ‰</div>
          <div data-action="enter" class="active">A</div>
          <div data-action="left">ðŸ ˆ</div>
          <div data-action="down">ðŸ ‹</div>
          <div data-action="right">ðŸ Š</div>
        </div>
      </div>
      <div class="col-3">
        <h2>Robot 3</h2>
        <p>Controls Robot 2</p>
        <div id="robot-3" class="wrapper">
          <div>
            <?xml version="1.0" encoding="iso-8859-1"?>
            <!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
            <svg
              fill="#000000"
              height="100%"
              width="100%"
              version="1.1"
              id="Capa_1"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              viewBox="0 0 490 490"
              xml:space="preserve"
            >
              <polygon
                points="456.851,0 245,212.564 33.149,0 0.708,32.337 212.669,245.004 0.708,457.678 33.149,490 245,277.443 456.851,490 
              489.292,457.678 277.331,245.004 489.292,32.337 "
              />
            </svg>
          </div>
          <div data-action="up">ðŸ ‰</div>
          <div data-action="enter" class="active">A</div>
          <div data-action="left">ðŸ ˆ</div>
          <div data-action="down">ðŸ ‹</div>
          <div data-action="right">ðŸ Š</div>
        </div>
      </div>
      <div class="col-3">
        <h2>My Input</h2>
        <p>Controls Robot 3</p>
        <div id="my-input" class="wrapper">
          <div>
            <?xml version="1.0" encoding="iso-8859-1"?>
            <!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
            <svg
              fill="#000000"
              height="100%"
              width="100%"
              version="1.1"
              id="Capa_1"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              viewBox="0 0 490 490"
              xml:space="preserve"
            >
              <polygon
                points="456.851,0 245,212.564 33.149,0 0.708,32.337 212.669,245.004 0.708,457.678 33.149,490 245,277.443 456.851,490 
              489.292,457.678 277.331,245.004 489.292,32.337 "
              />
            </svg>
          </div>
          <div id="my-keys-up">ðŸ ‰</div>
          <div id="my-keys-enter">A</div>
          <div id="my-keys-left">ðŸ ˆ</div>
          <div id="my-keys-down">ðŸ ‹</div>
          <div id="my-keys-right">ðŸ Š</div>
        </div>
      </div>
      <h3>Input Sequence:</h3>
      <div class="row">
        <div class="col-2">Input Robot 1</div>
        <div id="input-1" class="col-10"></div>
      </div>
      <div class="row">
        <div class="col-2">Input Robot 2</div>
        <div id="input-2" class="col-10"></div>
      </div>
      <div class="row">
        <div class="col-2">Input Robot 3</div>
        <div id="input-3" class="col-10"></div>
      </div>
      <div class="row">
        <div class="col-2">My Input</div>
        <div id="input-my" class="col-10"></div>
      </div>
      <h3>Output: <span id="output"></span></h3>
      <button id="btn-reset" class="btn btn-secondary my-2">Reset</button>
      <input class="form-control" type="text" id="INPUT_SEQUENCE" placeholder="Input sequence and press Go!" />
      <button id="btn-start" class="btn btn-warning my-2">Go!</button>
    </div>

    <script>
      $(() => {
        const robot1Pos = { y: 3, x: 2 };
        const robot2Pos = { y: 0, x: 2 };
        const robot3Pos = { y: 0, x: 2 };
        let run = false;

        let inputSeq1 = '';
        let inputSeq2 = '';
        let inputSeq3 = '';
        let inputSeqMy = '';
        let result = '';

        $('#btn-reset').click(() => {
          location.reload();
        });

        const moveRobot = (id, robot, y, x, yMax, absolute = false) => {
          $($(id).children()[robot.y * 3 + robot.x]).removeClass('active');
          robot.x = absolute ? x : Math.min(2, Math.max(0, robot.x + x));
          robot.y = absolute ? y : Math.min(yMax, Math.max(0, robot.y + y));
          $($(id).children()[robot.y * 3 + robot.x]).addClass('active');
        };

        const performActionRobot1 = () => {
          const value = $('#robot-1 > .active').attr('data-value');
          result += value;
          $('#output').text(result);
        };

        const performActionRobot2 = () => {
          const action = $('#robot-2 > .active').attr('data-action');
          console.log(`Robot 2: Performing '${action}'`);
          switch (action) {
            case 'up':
              moveRobot('#robot-1', robot1Pos, -1, 0, 3);
              inputSeq2 += '^';
              break;
            case 'down':
              moveRobot('#robot-1', robot1Pos, 1, 0, 3);
              inputSeq2 += 'v';
              break;
            case 'left':
              moveRobot('#robot-1', robot1Pos, 0, -1, 3);
              inputSeq2 += '<';
              break;
            case 'right':
              moveRobot('#robot-1', robot1Pos, 0, 1, 3);
              inputSeq2 += '>';
              break;
            case 'enter':
              inputSeq2 += 'A';
              performActionRobot1();
              break;
          }

          $('#input-2').text(inputSeq2 + ' Length: ' + inputSeq2.length);
        };

        const keys = [
          ['#my-keys-up', -1, 0, '^'],
          ['#my-keys-down', 1, 0, 'v'],
          ['#my-keys-left', 0, -1, '<'],
          ['#my-keys-right', 0, 1, '>'],
        ];
        for (let key of keys) {
          $(key[0]).click(() => {
            console.log('Clicked', key[0]);
            moveRobot('#robot-3', robot3Pos, key[1], key[2], 1);
            inputSeqMy += key[3];
            $('#input-my').text(inputSeqMy + ' Length: ' + inputSeqMy.length);
          });
        }
        $('#my-keys-enter').click(() => {
          const action = $('#robot-3 > .active').attr('data-action');
          console.log(`Robot 3: Performing '${action}'`);
          inputSeqMy += 'A';
          $('#input-my').text(inputSeqMy + ' Length: ' + inputSeqMy.length);

          // Perform the action for robot 2, robot 3 is over
          switch (action) {
            case 'up':
              inputSeq3 += '^';
              moveRobot('#robot-2', robot2Pos, -1, 0, 1);
              break;
            case 'down':
              inputSeq3 += 'v';
              moveRobot('#robot-2', robot2Pos, 1, 0, 1);
              break;
            case 'left':
              inputSeq3 += '<';
              moveRobot('#robot-2', robot2Pos, 0, -1, 1);
              break;
            case 'right':
              inputSeq3 += '>';
              moveRobot('#robot-2', robot2Pos, 0, 1, 1);
              break;
            case 'enter':
              inputSeq3 += 'A';
              performActionRobot2();
              break;
          }
          $('#input-3').text(inputSeq3 + ' Length: ' + inputSeq3.length);
        });

        document.onkeydown = (e) => {
          e = e || window.event;
          switch (e.keyCode) {
            case 37:
              $('#my-keys-left').trigger('click');
              break;
            case 38:
              $('#my-keys-up').trigger('click');
              break;
            case 39:
              $('#my-keys-right').trigger('click');
              break;
            case 40:
              $('#my-keys-down').trigger('click');
              break;
            case 35:
            case 13:
              $('#my-keys-enter').trigger('click');
              break;
          }
        };

        let INPUT_SEQUENCE = '';

        const step = (i = 0) => {
          switch (INPUT_SEQUENCE[i]) {
            case '<':
              $('#my-keys-left').trigger('click');
              break;
            case '^':
              $('#my-keys-up').trigger('click');
              break;
            case 'v':
              $('#my-keys-down').trigger('click');
              break;
            case '>':
              $('#my-keys-right').trigger('click');
              break;
            case 'A':
              $('#my-keys-enter').trigger('click');
              break;
          }

          if (i < INPUT_SEQUENCE.length) {
            setTimeout(() => step(i + 1), 250);
          }
        };

        $('#btn-start').click(() => {
          INPUT_SEQUENCE = $('#INPUT_SEQUENCE').val();
          step();
        });
      });
    </script>
  </body>
</html>
